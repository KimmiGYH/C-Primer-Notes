- [编译内存](#编译内存)
  - [C++ 程序编译过程](#c-程序编译过程)
    - [编译的四个过程](#编译的四个过程)
    - [静态链接库 vs 动态链接库](#静态链接库-vs-动态链接库)

# 编译内存

##  C++ 程序编译过程

###  编译的四个过程

![编译过程](C++图库/编译过程.png)

- **编译预处理**：处理以 `#` 开头的指令；
- **编译、优化**：将源码 `.cpp` 文件翻译成 `.s` 汇编代码；
- **汇编**：将汇编代码 `.s` 翻译成机器指令 `.o` 文件；
- **链接**：汇编程序生成的目标文件，即 `.o` 文件，并不会立即执行，因为可能会出现：`.cpp` 文件中的函数引用了另一个 `.cpp` 文件中定义的符号或者调用了某个库文件中的函数。那链接的目的就是将这些文件对应的目标文件连接成一个整体，从而生成可执行的程序 `.exe` 文件。

### 静态链接库 vs 动态链接库

[B站视频：动态库与静态库讲解](https://www.bilibili.com/video/BV1XE411k7PN)

![静态库vs动态库](C++图库/静态库vs动态库.png)

链接分为两种：

- **静态链接**：代码从其所在的静态链接库中拷贝到最终的可执行程序中，在该程序被执行时，这些代码会被装入到该进程的虚拟地址空间中。
- **动态链接**：代码被放到动态链接库或共享对象的某个目标文件中，链接程序只是在最终的可执行程序中记录了共享对象的名字等一些信息。在程序执行时，动态链接库的全部内容会被映射到运行时相应进行的虚拟地址的空间。

**二者的优缺点：**

- 静态链接：
  - 优点：代码合并到模块中，无零散文件。
  - 缺点：模块体积变大，当多个模块使用该库时，内存中有多份代码。
  - **浪费空间**，每个可执行程序都会有目标文件的一个副本，这样如果目标文件进行了更新操作，就需要重新进行编译链接生成可执行程序（**更新困难**）；优点就是执行的时候运行速度快，因为可执行程序具备了程序运行的所有内容。

- 动态链接：
  - 优点：模块体积几乎不变，当多个模块使用该库时，内存中只存在一份代码。
  - 缺点：代码在单独文件中，有零散文件。
  - 节省内存、更新方便，但是动态链接是在程序运行时，每次执行都需要链接，相比静态链接会有一定的性能损失。






